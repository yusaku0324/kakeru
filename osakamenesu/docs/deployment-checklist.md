# ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã«ç¢ºèªã™ã¹ãé …ç›®ã‚’ã¾ã¨ã‚ãŸã‚‚ã®ã§ã™ã€‚

## ğŸš€ è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆæ¨å¥¨ï¼‰

mainãƒ–ãƒ©ãƒ³ãƒã¸ã®ãƒãƒ¼ã‚¸æ™‚ã«è‡ªå‹•çš„ã«ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
- API (Fly.io): `services/api/**` é…ä¸‹ã®å¤‰æ›´æ™‚
- Web (Vercel): è‡ªå‹•ï¼ˆVercelé€£æºï¼‰

## ğŸ“‹ æ‰‹å‹•ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### 1. ãƒ‡ãƒ—ãƒ­ã‚¤å‰ç¢ºèª

- [ ] **ãƒ–ãƒ©ãƒ³ãƒç¢ºèª**
  ```bash
  git branch --show-current  # main ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
  git pull origin main       # æœ€æ–°ã‚’å–å¾—
  ```

- [ ] **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ**
  ```bash
  # API ãƒ†ã‚¹ãƒˆ
  cd services/api
  poetry run pytest -v

  # Web ãƒ†ã‚¹ãƒˆ
  cd apps/web
  pnpm test
  ```

- [ ] **ãƒ“ãƒ«ãƒ‰ç¢ºèª**
  ```bash
  # API
  cd services/api
  docker build -t osakamenesu-api .

  # Web
  cd apps/web
  pnpm build
  ```

### 2. ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã§ã®æ¤œè¨¼

- [ ] **ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã¸ãƒ‡ãƒ—ãƒ­ã‚¤**
  ```bash
  cd services/api
  fly deploy --app osakamenesu-api-stg --config fly.stg.toml
  ```

- [ ] **å‹•ä½œç¢ºèªé …ç›®**
  - [ ] ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯: `https://osakamenesu-api-stg.fly.dev/health`
  - [ ] èªè¨¼ãƒ•ãƒ­ãƒ¼: ãƒã‚¸ãƒƒã‚¯ãƒªãƒ³ã‚¯ã®é€å—ä¿¡
  - [ ] æ¤œç´¢æ©Ÿèƒ½: Meilisearché€£æº
  - [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š: åŸºæœ¬çš„ãªCRUDæ“ä½œ

- [ ] **E2Eãƒ†ã‚¹ãƒˆå®Ÿè¡Œ**
  ```bash
  cd apps/web
  NEXT_PUBLIC_API_BASE=https://osakamenesu-api-stg.fly.dev pnpm e2e
  ```

### 3. æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤

- [ ] **ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œ**
  ```bash
  cd services/api
  fly deploy --app osakamenesu-api
  ```

- [ ] **ãƒ‡ãƒ—ãƒ­ã‚¤çŠ¶æ³ç¢ºèª**
  ```bash
  fly status --app osakamenesu-api
  fly logs --app osakamenesu-api | tail -100
  ```

### 4. ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œç¢ºèª

- [ ] **ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯**
  ```bash
  curl https://osakamenesu-api.fly.dev/health
  ```

- [ ] **ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ç¢ºèª**
  - [ ] Fly.io ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰: CPU/ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡
  - [ ] Sentry: ã‚¨ãƒ©ãƒ¼ç™ºç”ŸçŠ¶æ³
  - [ ] Railway: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šçŠ¶æ³

- [ ] **æ©Ÿèƒ½ç¢ºèª**
  - [ ] æœ¬ç•ªã‚µã‚¤ãƒˆã§ã®åŸºæœ¬å‹•ä½œç¢ºèª
  - [ ] èªè¨¼ãƒ•ãƒ­ãƒ¼ã®å‹•ä½œç¢ºèª
  - [ ] æ¤œç´¢æ©Ÿèƒ½ã®å‹•ä½œç¢ºèª

### 5. ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆï¼š

```bash
# å‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
fly releases --app osakamenesu-api
fly deploy --app osakamenesu-api --image <å‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ã‚¤ãƒ¡ãƒ¼ã‚¸>
```

## ğŸ” ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç®¡ç†

### ç’°å¢ƒå¤‰æ•°ã®æ›´æ–°

```bash
# å˜ä¸€ã®ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š
fly secrets set KEY=value --app osakamenesu-api

# è¤‡æ•°ã®ç’°å¢ƒå¤‰æ•°ã‚’ä¸€æ‹¬è¨­å®š
fly secrets set KEY1=value1 KEY2=value2 --app osakamenesu-api

# ç’°å¢ƒå¤‰æ•°ã®ç¢ºèª
fly secrets list --app osakamenesu-api
```

## ğŸ“Š ãƒ‡ãƒ—ãƒ­ã‚¤é »åº¦ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

- **æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤**: 1æ—¥1-2å›ã¾ã§ï¼ˆç·Šæ€¥æ™‚ã‚’é™¤ãï¼‰
- **ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚é–“å¸¯**:
  - æ¨å¥¨: 10:00-12:00, 14:00-17:00 JST
  - é¿ã‘ã‚‹: 18:00-22:00 JSTï¼ˆãƒ”ãƒ¼ã‚¯ã‚¿ã‚¤ãƒ ï¼‰
- **é‡‘æ›œæ—¥ãƒ‡ãƒ—ãƒ­ã‚¤**: ç·Šæ€¥ä¿®æ­£ã®ã¿

## ğŸš¨ ç·Šæ€¥æ™‚ã®é€£çµ¡å…ˆ

- Fly.io ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: https://status.flyio.net/
- Railway ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: https://status.railway.app/
- Vercel ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: https://www.vercel-status.com/

## ğŸ“ ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ­ã‚°

ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿæ–½æ™‚ã¯ä»¥ä¸‹ã®æƒ…å ±ã‚’è¨˜éŒ²ï¼š

```markdown
### YYYY-MM-DD HH:MM JST
- **æ‹…å½“è€…**: @username
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: vXX (Fly.io release number)
- **ä¸»ãªå¤‰æ›´**:
  - æ©Ÿèƒ½è¿½åŠ /ä¿®æ­£ã®æ¦‚è¦
- **ç¢ºèªäº‹é …**: âœ… å…¨ã¦æ­£å¸¸
```
