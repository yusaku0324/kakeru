# 本番環境デプロイメントチェックリスト

## デプロイ承認

- [ ] プロジェクトオーナー承認
- [ ] 技術責任者承認
- [ ] Staging環境テスト完了確認書

承認日時: _______________
承認者署名: _______________

## 1. デプロイ前準備（D-1日）

### 1.1 コード準備
- [ ] mainブランチが最新
- [ ] 全テスト通過（CI/CD確認）
- [ ] セキュリティスキャン完了
- [ ] コードレビュー完了

### 1.2 インフラ確認
- [ ] Railway production環境準備完了
- [ ] Vercel production環境準備完了
- [ ] ドメイン設定確認
- [ ] SSL証明書有効

### 1.3 バックアップ
- [ ] データベース完全バックアップ実行
- [ ] バックアップファイル検証
- [ ] リストア手順確認
- [ ] 前バージョンのDockerイメージ保存

### 1.4 通知準備
- [ ] メンテナンス告知準備（必要な場合）
- [ ] 社内関係者への連絡
- [ ] サポートチーム待機確認

## 2. デプロイ当日準備（D-Day 実施2時間前）

### 2.1 最終確認
- [ ] 現在のトラフィック確認
- [ ] エラー率確認（通常範囲内）
- [ ] 外部サービス稼働確認
  - [ ] SendGrid
  - [ ] Google OAuth
  - [ ] LINE OAuth
  - [ ] Sentry

### 2.2 チーム準備
- [ ] デプロイ担当者: _______________
- [ ] 監視担当者: _______________
- [ ] ロールバック担当者: _______________
- [ ] 連絡担当者: _______________

## 3. デプロイ実施

### 3.1 API デプロイ（Railway）

**Step 1: デプロイ開始**
- [ ] 開始時刻記録: _______________
- [ ] `./scripts/deploy.sh production api` 実行

**Step 2: マイグレーション**
- [ ] DBバックアップ最終確認
- [ ] `railway run --environment production alembic upgrade head`
- [ ] マイグレーション成功確認

**Step 3: ヘルスチェック**
- [ ] `curl https://api.osakamenesu.com/health`
- [ ] レスポンス正常確認
- [ ] ログ確認（エラーなし）

### 3.2 Web デプロイ（Vercel）

**Step 1: デプロイ開始**
- [ ] `./scripts/deploy.sh production web` 実行
- [ ] ビルド成功確認

**Step 2: 動作確認**
- [ ] トップページアクセス
- [ ] 主要ページ表示確認
- [ ] API接続確認

### 3.3 即時確認項目（デプロイ後15分）

**機能確認:**
- [ ] ログイン機能（Google）
- [ ] ログイン機能（LINE）
- [ ] ゲスト検索機能
- [ ] 予約作成機能
- [ ] 管理画面アクセス

**監視確認:**
- [ ] Sentryエラーなし
- [ ] アクセスログ正常
- [ ] レスポンスタイム正常

## 4. デプロイ後監視（最初の1時間）

### 4.1 メトリクス監視

**15分ごとに確認:**
- [ ] 0:15 - エラー率: _____ %
- [ ] 0:30 - エラー率: _____ %
- [ ] 0:45 - エラー率: _____ %
- [ ] 1:00 - エラー率: _____ %

**パフォーマンス:**
- [ ] API p95 レスポンスタイム: _____ ms
- [ ] Web Core Web Vitals正常
- [ ] データベース接続数正常

### 4.2 ユーザー影響確認
- [ ] 新規予約作成可能
- [ ] 既存予約表示正常
- [ ] 通知送信正常

## 5. ロールバック判断基準

以下のいずれかに該当する場合、即座にロールバック：

- [ ] エラー率が5%を超える
- [ ] 主要機能が動作しない
- [ ] データ不整合の発生
- [ ] レスポンスタイムがp95で3秒を超える

ロールバック実施時刻: _______________
ロールバック実施者: _______________

## 6. ロールバック手順

### 6.1 API ロールバック
```bash
# Railwayロールバック
railway rollback --environment production

# DB必要に応じて
railway run --environment production alembic downgrade -1
```

### 6.2 Web ロールバック
1. Vercel Dashboard → Deployments
2. 前のデプロイメント選択
3. "Promote to Production" クリック

### 6.3 ロールバック後確認
- [ ] サービス復旧確認
- [ ] エラー率正常化
- [ ] 原因調査開始

## 7. デプロイ完了処理（成功時）

### 7.1 最終確認（デプロイ後24時間）
- [ ] エラー率が通常範囲内
- [ ] パフォーマンス指標正常
- [ ] ユーザーからの問題報告なし

### 7.2 ドキュメント更新
- [ ] リリースノート作成
- [ ] 既知の問題リスト更新
- [ ] デプロイログ保存

### 7.3 通知
- [ ] ステークホルダーへの完了報告
- [ ] チームへの完了通知
- [ ] 次回デプロイ計画の調整

## 8. 事後レビュー（デプロイ後1週間以内）

### 8.1 レビュー項目
- [ ] デプロイプロセスの問題点
- [ ] 予期しない問題の発生有無
- [ ] 改善提案のまとめ

### 8.2 メトリクスレビュー
- [ ] デプロイ所要時間
- [ ] ダウンタイム（あれば）
- [ ] ユーザー影響度

## 緊急連絡先

**技術責任者:**
- 名前: _______________
- 電話: _______________
- Slack: _______________

**インフラ担当:**
- 名前: _______________
- 電話: _______________
- Slack: _______________

**Railway サポート:**
- URL: https://railway.app/support
- 緊急度: Production Down

**Vercel サポート:**
- URL: https://vercel.com/support
- 緊急度: Production Issue

---

## デプロイ記録

**デプロイ情報:**
- 実施日時: _______________
- バージョン: _______________
- 実施者: _______________

**結果:**
- [ ] 成功
- [ ] 部分的成功
- [ ] ロールバック実施

**所要時間:**
- API: _____ 分
- Web: _____ 分
- 合計: _____ 分

**特記事項:**
_________________________________
_________________________________
_________________________________

**次回への申し送り:**
_________________________________
_________________________________
_________________________________

承認者確認: _______________
日付: _______________